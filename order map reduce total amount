// Step 1ï¸âƒ£ â€” Use or create database
use EmployeeDB;

// Step 2ï¸âƒ£ â€” Create "orders" collection and insert sample data
db.orders.insertMany([
  { Orderid: 1, custid: "C1", date: "2025-11-06", amount: 500 },
  { Orderid: 2, custid: "C2", date: "2025-11-06", amount: 1000 },
  { Orderid: 3, custid: "C1", date: "2025-11-07", amount: 200 },
  { Orderid: 4, custid: "C2", date: "2025-11-07", amount: 1500 },
  { Orderid: 5, custid: "C3", date: "2025-11-08", amount: 800 }
]);

// Step 3ï¸âƒ£ â€” Define the Map Function
var mapFunction = function() {
  emit(this.custid, this.amount);
};

// Step 4ï¸âƒ£ â€” Define the Reduce Function
var reduceFunction = function(key, values) {
  return Array.sum(values);
};

// Step 5ï¸âƒ£ â€” Execute MapReduce to calculate total amount per customer
db.orders.mapReduce(
  mapFunction,
  reduceFunction,
  { out: "totalAmountPerCustomer" }
);

// Step 6ï¸âƒ£ â€” View the MapReduce output
print("=== Total Amount Per Customer ===");
db.totalAmountPerCustomer.find().pretty();

// Step 7ï¸âƒ£ â€” Create index on custid for faster queries
db.orders.createIndex({ custid: 1 });

// Step 8ï¸âƒ£ â€” Check existing indexes
print("=== Indexes in Orders Collection ===");
db.orders.getIndexes();

// Step 9ï¸âƒ£ â€” Example: Use index for quick search
print("=== Orders of Customer C2 ===");
db.orders.find({ custid: "C2" }).pretty();


MapReduce is a data processing framework used in MongoDB to perform aggregation operations like summing, counting, or averaging large datasets.
It works in two phases â€” Map and Reduce â€” similar to how Hadoop processes data.

ğŸ”¹ 2. What are the two main functions in MapReduce?

Answer:

Map Function: Emits (key, value) pairs from each document.

Reduce Function: Groups values by key and performs aggregation (like sum, count, etc.).

ğŸ”¹ 3. What is the role of emit() function in MapReduce?

Answer:
emit(key, value) is used in the map function to output key-value pairs.
Example:

emit(this.custid, this.amount);


This means weâ€™re associating each custid with their order amount.

ğŸ”¹ 4. What does the reduce() function do?

Answer:
It takes all values that have the same key (like all amounts for the same custid) and combines them, usually by summing, counting, or averaging them.

Example:

return Array.sum(values);

ğŸ”¹ 5. What is the output of MapReduce stored as?

Answer:
The output is stored as a new collection (defined in the out option) or returned directly if out: { inline: 1 }.

Example:

{ out: "totalAmountPerCustomer" }
